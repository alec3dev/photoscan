<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crop & Download Portraits</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    canvas { border: 1px solid #ccc; margin-bottom: 10px; }
    .preview { display: flex; flex-wrap: wrap; gap: 10px; }
    .crop-box { display: flex; flex-direction: column; align-items: center; }
    input[type="text"] { margin-top: 5px; }
  </style>
</head>
<body>

<h2>Upload Image</h2>
<input type="file" id="imageInput" accept="image/*"><br><br>
<canvas id="mainCanvas"></canvas>

<h2>Cropped Previews</h2>
<div class="preview" id="previewContainer"></div>

<script>
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
const previewContainer = document.getElementById('previewContainer');

document.getElementById('imageInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const img = new Image();
  img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);
    extractPortraits(img);
  };
  img.src = URL.createObjectURL(file);
});

function extractPortraits(img) {
  previewContainer.innerHTML = '';

  // Define rectangles manually (based on your image layout)
  const boxes = [
    { x: 50, y: 50, w: 200, h: 250 },
    { x: 300, y: 50, w: 200, h: 250 },
    { x: 550, y: 50, w: 200, h: 250 },
    { x: 50, y: 350, w: 200, h: 250 },
    { x: 300, y: 350, w: 200, h: 250 },
    { x: 550, y: 350, w: 200, h: 250 },
    { x: 800, y: 350, w: 200, h: 250 }
  ];

  boxes.forEach((box, i) => {
    const cropCanvas = document.createElement('canvas');
    cropCanvas.width = box.w;
    cropCanvas.height = box.h;
    const cropCtx = cropCanvas.getContext('2d');
    cropCtx.drawImage(img, box.x, box.y, box.w, box.h, 0, 0, box.w, box.h);

    const container = document.createElement('div');
    container.className = 'crop-box';

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = `portrait_${i + 1}.png`;

    const button = document.createElement('button');
    button.textContent = 'Download';
    button.onclick = () => {
      const link = document.createElement('a');
      link.download = input.value || `portrait_${i + 1}.png`;
      link.href = cropCanvas.toDataURL();
      link.click();
    };

    container.appendChild(cropCanvas);
    container.appendChild(input);
    container.appendChild(button);
    previewContainer.appendChild(container);
  });
}
</script>

</body>
</html>
